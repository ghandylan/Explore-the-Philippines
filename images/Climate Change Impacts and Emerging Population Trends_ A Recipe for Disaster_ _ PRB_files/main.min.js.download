/* ========================================================================
 * DOM-based Routing
 * Based on http://goo.gl/EUTi53 by Paul Irish
 *
 * Only fires on body classes that match. If a body class contains a dash,
 * replace the dash with an underscore when adding it to the object below.
 *
 * .noConflict()
 * The routing is enclosed within an anonymous function so that you can
 * always reference jQuery with $, even when in .noConflict() mode.
 *
 * Google CDN, Latest jQuery
 * To use the default WordPress version of jQuery, go to lib/config.php and
 * remove or comment out: add_theme_support('jquery-cdn');
 * ======================================================================== */

(function ($) {

    $.resizeend = function (el, options) {
        var base = this;

        base.$el = $(el);
        base.el = el;

        base.$el.data("resizeend", base);
        base.rtime = new Date(1, 1, 2000, 12, 00, 00);
        base.timeout = false;
        base.delta = 200;

        base.init = function () {
            base.options = $.extend({}, $.resizeend.defaultOptions, options);

            if (base.options.runOnStart) base.options.onDragEnd();

            $(base.el).resize(function () {

                base.rtime = new Date();
                if (base.timeout === false) {
                    base.timeout = true;
                    setTimeout(base.resizeend, base.delta);
                }
            });

        };
        base.resizeend = function () {
            if (new Date() - base.rtime < base.delta) {
                setTimeout(base.resizeend, base.delta);
            } else {
                base.timeout = false;
                base.options.onDragEnd();
            }
        };

        base.init();
    };

    $.resizeend.defaultOptions = {
        onDragEnd: function () {
        },
        runOnStart: false
    };

    $.fn.resizeend = function (options) {
        return this.each(function () {
            (new $.resizeend(this, options));
        });
    };

    jQuery.fn.scrollOffset = function () {
        var win = $(window);
        var topSpace = this.offset().top - win.scrollTop();
        var bottomSpace = win.height() - this.height() - topSpace;
        var leftSpace = this.offset().left;
        var rightSpace = win.width() - this.width() - leftSpace;
        return {top: topSpace, bottom: bottomSpace, left: leftSpace, right: rightSpace};
    };

    function isElementInViewport(el, verticaloffset) {
        var win = $(window);

        var viewport = {
            top: win.scrollTop(),
            left: win.scrollLeft()
        };
        viewport.right = viewport.left + win.width();
        viewport.bottom = viewport.top + win.height();

        var bounds = el.offset();
        bounds.right = bounds.left + el.outerWidth();
        bounds.bottom = bounds.top + el.outerHeight();

        return (!(viewport.right < bounds.left || viewport.left > bounds.right || viewport.bottom < bounds.top || viewport.top > bounds.bottom));

    }

    // vertical scroll function
    var scrollLength = 0;

    function verticalScroll(element, scrollAmount) {
        scrollLength = scrollLength + scrollAmount;
        $(element).animate({
            scrollTop: scrollLength
        }, 200);
    }

    function viewport() {
        var e = window, a = 'inner';
        if (!('innerWidth' in window)) {
            a = 'client';
            e = document.documentElement || document.body;
        }
        return {width: e[a + 'Width'], height: e[a + 'Height']};
    }

// Use this variable to set up the common and page specific functions. If you
// rename this variable, you will also need to rename the namespace below.
    var Roots = {

        /*
          Preload
        */
        preload: {
            init: function () {

                console.log($(".cvf_universal_container"));

                /* Mobile Nav Toggle */
                $('.menu-toggle').on('click', function () {
                    var menu_height = $('.header--top').outerHeight() + $('.header--bottom').outerHeight();
                    $(this).toggleClass('open');
                    $('.section__header').toggleClass('open');

                    if ($('.section__header').hasClass('open')) {
                        $('.section__header').css('max-height', menu_height + 'px');
                    } else {
                        $('.section__header').css('max-height', '');
                    }
                });

                $('.dropdown-toggle').on('click', function (e) {
                    e.preventDefault();
                    if ($(window).width() < 993) {
                        var menu_height = $('.header--top').outerHeight() + $('.header--bottom').outerHeight();
                        var dropdown_length = $(this).siblings('.dropdown-menu__primary').children('li').length;
                        var li_height = $(this).siblings('.dropdown-menu__primary').children('li').outerHeight();
                        var new_dd_height = 0;
                        $('.dropdown-menu__primary > li').each(function () {
                            new_dd_height += $(this).outerHeight();
                        });
                        var menu_dropdown_height = menu_height + new_dd_height;


                        if ($(this).hasClass('open')) {
                            $(this).removeClass('open');
                            $(this).parent().removeClass('open');
                            $(this).siblings('.dropdown-menu__primary').removeClass('open');

                            $('.dropdown-menu__primary').css('max-height', '');
                            $(this).siblings('.dropdown-menu__primary').css('max-height', '');
                            $('.section__header').css('max-height', menu_height + 'px');
                        } else {
                            $('.dropdown').removeClass('open');
                            $('.dropdown-toggle').removeClass('open');
                            $('.dropdown-menu__primary').removeClass('open');
                            $(this).addClass('open');
                            $(this).parent().addClass('open');
                            $(this).siblings('.dropdown-menu__primary').addClass('open');

                            $('.dropdown-menu__primary').css('max-height', '');
                            $(this).siblings('.dropdown-menu__primary').css('max-height', new_dd_height + 'px');
                            $('.section__header').css('max-height', menu_dropdown_height + 'px');


                        }
                    } else {
                        if ($(this).hasClass('open')) {
                            $(this).removeClass('open');
                            $(this).siblings('.dropdown-menu__primary').removeClass('open');
                            $('.nav-main .nav__close').fadeOut(200);
                        } else {
                            $('.dropdown-toggle').removeClass('open');
                            $('.dropdown-menu__primary').removeClass('open');
                            $(this).addClass('open');
                            $(this).siblings('.dropdown-menu__primary').addClass('open');
                            $('.nav-main .nav__close').fadeIn(400);
                        }
                    }

                    $(this).siblings('.dropdown-menu__primary').mouseleave(function () {
                        $(this).removeClass('open');
                        $(this).parent().removeClass('open');
                        $(this).siblings('.dropdown-menu__primary').removeClass('open');

                        $('.dropdown-menu__primary').css('max-height', '');
                        $(this).siblings('.dropdown-menu__primary').css('max-height', '');
                        $('.section__header').css('max-height', menu_height + 'px');
                        $('.nav-main .nav__close').fadeOut(200);
                    });


                });

                $('.nav-main .nav__close').on('click', function () {
                    $('.section__header').removeClass('open').css('max-height', '');
                    $('.menu-toggle').removeClass('open');
                    $('.dropdown').removeClass('open');
                    $('.dropdown-toggle').removeClass('open');
                    $('.dropdown-menu__primary').removeClass('open').css('max-height', '');
                    if ($(window).width() > 992) {
                        $('.nav-main .nav__close').fadeOut(200);
                    }

                });

                /* Search Toggle */
                $('.search-toggle').on('click', function (e) {
                    e.preventDefault();
                    $('.form__search').toggleClass('open');
                });


                /* Smooth Scroll */
                $('.scroll-top').click(function () {
                    $('html, body').animate({
                        scrollTop: 0
                    }, 700);
                    return false;
                });
                $('.btn__scroll:not(.scroll-top)').click(function () {
                    $('html, body').animate({
                        scrollTop: $($(this).attr('href')).offset().top
                    }, 700);
                    return false;
                });

                // Let the document know when the mouse is being used
                document.body.addEventListener('mousedown', function () {
                    document.body.classList.add('using-mouse');
                });

                // Re-enable focus styling when Tab is pressed
                document.body.addEventListener('keydown', function (event) {
                    if (event.keyCode === 9) {
                        document.body.classList.remove('using-mouse');
                    }
                });

                /* Share Toggle */
                $('.btn__share-toggle').on('click', function (e) {
                    e.preventDefault();
                    $(this).toggleClass('open');
                    $(this).siblings('.dropdown__share').toggleClass('open');
                    console.log("clicked share brn");
                });

                // Close share with esc key
                $(document).keydown(function (e) {
                    if (e.keyCode == 27) {
                        $('.btn__share-toggle').removeClass('open');
                        $('.dropdown__share').removeClass('open');
                    }
                });


                $(".media__blocks .media__container--video").each(function () {
                    var play_btn = $(this).children('.overlay').children('.btn__play');
                    play_btn.on('click', function () {

                        $(this).parent().fadeOut(400);
                        // var symbol = $(this).parent().parent().children(".video")[0].src.indexOf("?") > -1 ? "&" : "?";
                        // //modify source to autoplay and start video
                        var data_src = $(this).parent().siblings(".video__src").attr('data-src');
                        if (!data_src) {
                            data_src = $(this).parent().siblings(".video__src")[0].src;
                            $(this).parent().siblings(".video__src")[0].src = data_src + "&autoplay=1";
                        } else {
                            $(this).parent().siblings(".video__src")[0].src = data_src + "&autoplay=1";
                        }

                    });
                });


                $(".section").each(function (index) {
                    /* Gallery Sliders */
                    var currentIndex = 0,
                        items = $('.section__img-gallery[data-gallery="' + index + '"] .slider li'),
                        itemAmt = items.length;

                    function cycleItems() {
                        var item = $('.section__img-gallery[data-gallery="' + index + '"] .slider li').eq(currentIndex);
                        item.addClass('active');
                    }

                    $('.section__img-gallery[data-gallery="' + index + '"] .btn__toggle-next').on('click', function (event) {
                        event.preventDefault();
                        items.removeClass('active');
                        currentIndex += 1;
                        if (currentIndex > itemAmt - 1) {
                            currentIndex = 0;
                        }
                        cycleItems();
                    });

                    $('.section__img-gallery[data-gallery="' + index + '"] .btn__toggle-prev').on('click', function (event) {
                        event.preventDefault();
                        items.removeClass('active');
                        currentIndex -= 1;
                        if (currentIndex < 0) {
                            currentIndex = itemAmt - 1;
                        }
                        cycleItems();
                    });

                    /* Load More */
                    var btn_text = $('.section__general-content[data-more-content="' + index + '"] .btn__more span').text();
                    $('.section__general-content[data-more-content="' + index + '"] .btn__more').on('click', function (e) {
                        e.preventDefault();

                        var data_hide = $('.section__general-content[data-more-content="' + index + '"] .content').attr('data-hide');
                        if ($(this).hasClass('open')) {
                            $(this).removeClass('open');
                            $(this).children('span').text(btn_text);
                            //$('.section__general-content[data-more-content="' + index + '"] .content p:nth-child(' + data_hide + ') ~ *:not(.btn), .section__general-content[data-more-content="' + index + '"] .content h2:nth-child(' + data_hide + ') + p ~ *:not(.btn)').fadeOut(400);
                            $('.section__general-content[data-more-content="' + index + '"] .visible').fadeOut(400).removeClass('visible');
                            $('.section__general-content[data-more-content="' + index + '"] .btn *').fadeIn(400);
                            $('html, body').animate({
                                scrollTop: $('.section__general-content[data-more-content="' + index + '"]').offset().top
                            }, 400);
                        } else {
                            $(this).addClass('open');
                            $(this).children('span').text('Less');
                            $('.section__general-content[data-more-content="' + index + '"] *:hidden').addClass('visible');
                            $('.section__general-content[data-more-content="' + index + '"] *:not(.btn)').fadeIn(400);
                            $('html, body').animate({
                                scrollTop: $(this).parent().offset().top
                            }, 400);
                        }

                    });

                });

                /* FAQs */
                $(".faqs .faq__question").on("click", function (e) {
                    e.preventDefault();
                    var li = $(this).parent();
                    var answer = $(this).siblings(".faq__answer");
                    var height = answer.children(".section__general-content").outerHeight();

                    $(".faqs .faq, .faq__question").removeClass("open");
                    $(this).toggleClass('open');
                    li.toggleClass("open");
                    answer.toggleClass("open");

                    if (answer.hasClass("open")) {
                        $(".faqs .faq__answer").removeClass("open").css("max-height", "");
                        answer.addClass("open");
                        answer.css("max-height", height + "px");
                    } else {
                        $(".faqs .faq, .faq__question").removeClass("open");
                        answer.css("max-height", "");
                    }
                });
                $(window).on('load', function () {
                    var page_header_height = $('.section__page-header').outerHeight();
                    $('.quick_links, .quick_links_toggle:not(.quick_links_toggle--close)').css('top', 'calc(60px + ' + page_header_height + 'px');
                });


                $(window).scroll(function (e) {
                    var $el = $('.quick_links'),
                        navHeight = $el.outerHeight(),
                        header_height = $('.section__page-header').outerHeight(),
                        isPositionFixed = ($el.css('position') == 'fixed');
                    if ($(this).scrollTop() > header_height && !isPositionFixed) {
                        $('.quick_links, .quick_links_toggle:not(.quick_links_toggle--close)').addClass('fixed');
                    }
                    if ($(this).scrollTop() < header_height && isPositionFixed) {
                        $('.quick_links, .quick_links_toggle:not(.quick_links_toggle--close)').removeClass('fixed');
                    }
                });

                /* Quick Links Toggle */
                $('.quick_links_toggle').on('click', function () {
                    $(this).toggleClass('close');
                    $('.quick_links').toggleClass('close');
                });

                // FLICKITY Carousel
                if ($('.main-carousel').hasClass('arrows-hidden') && screen.width > 768) {
                    $('.main-carousel').flickity({
                      // options
                      cellAlign: 'left',
                      contain: true,
                      wrapAround: true,
                      prevNextButtons: false, 
                    });
                  } else {
                    $('.main-carousel').flickity({
                      // options
                      cellAlign: 'left',
                      contain: true,
                      wrapAround: true,
                    });
                  }

                $(function () {
                    $(".datepicker").datepicker();
                });

                /* Alert Banner */
                $('.header__banner .banner__close').on('click', function (e) {
                    e.preventDefault();
                    $('.header__banner').stop().animate({height: '0'}, 400);
                    $('.header__banner').addClass('closed');
                });

                $('.sidebar__toggle').on('click', function (e) {
                    e.preventDefault();
                    var sidebar_height = $(this).siblings('.sidebar__content').children('.container').outerHeight();
                    $(this).toggleClass('open');
                    $(this).siblings('.sidebar__content').toggleClass('open');
                    if ($(this).hasClass('open')) {
                        $(this).siblings('.sidebar__content').css('max-height', sidebar_height + 'px');
                    } else {
                        $(this).siblings('.sidebar__content').css('max-height', '');
                    }
                });
                $('.sidebar__close').on('click', function (e) {
                    e.preventDefault();
                    console.log('close');
                    $('.sidebar__toggle').removeClass('open');
                    $(this).parent().parent().removeClass('open');
                    $(this).parent().parent().css('max-height', '');
                });
            }
        },


        /*
          Front Page
        */
        home: {
            init: function () {
                /* Page Banner Slider */
                var currentIndex = 0,
                    items = $('.banner__slides .slide'),
                    items_bg = $('.section__page-banner .bg__img'),
                    toggle = $('.section__page-banner .toggle'),
                    itemAmt = items.length;

                function cycleItems() {
                    var item = $('.banner__slides .slide').eq(currentIndex);
                    var item_bg = $('.section__page-banner .bg__img').eq(currentIndex);
                    var toggle = $('.section__page-banner .toggle').eq(currentIndex);

                    item.addClass('active');
                    item_bg.addClass('active');
                    toggle.addClass('active');


                }

                // Set up autoslide timer
                var autoSlide;
                var timer = function () {
                    autoSlide = setInterval(function () {
                        items.removeClass('active');
                        items_bg.removeClass('active');
                        toggle.removeClass('active');
                        currentIndex += 1;
                        if (currentIndex > itemAmt - 1) {
                            currentIndex = 0;
                        }
                        cycleItems();
                    }, 8000);
                };
                timer();

                /* Toggles */
                $('.section__page-banner .toggle').on('click', function (event) {
                    event.preventDefault();
                    var slide = $(this).attr('data-slide');

                    // Clear autoslide and reset it
                    clearInterval(autoSlide);
                    timer();
                    /* Remove class active */
                    $('.section__page-banner .toggle').removeClass('active');
                    $('.banner__slides .slide, .section__page-banner .bg__img').removeClass('active');

                    /* Add class active to this toggle and the event that it is associated with */
                    $(this).addClass('active');
                    $('.banner__slides .slide[data-slide=' + slide + '], .section__page-banner .bg__img[data-slide=' + slide + ']').addClass('active');

                    /* Change current index to this toggle/event */
                    currentIndex = slide;
                    cycleItems();
                });
            }
        },

        /*
          Resource Library
        */
        page_template_template_resources: {
            init: function () {


                /* Sidebar */
                $('.sidebar .sidebar__title').on('click', function (e) {
                    e.preventDefault();
                    var filter_height = $('.filters .content').outerHeight();
                    $(this).toggleClass('open');
                    $('.filters').toggleClass('open');
                    if ($('.filters').hasClass('open')) {
                        $('.filters').css('max-height', filter_height + 'px');
                    } else {
                        $('.filters').css('max-height', '');
                    }
                });

                $('.filter .dropdown .current').on('click', function (e) {
                    e.preventDefault();

                    var dropdown_height = $(this).siblings('.dropdown__list').outerHeight() + $(this).outerHeight() + 2;
                    var dropdown_container = $(this).parent('.dropdown');


                    if (dropdown_container.hasClass('open')) {

                        dropdown_container.siblings('.current').removeClass('open');
                        dropdown_container.removeClass('open');

                        $('.filter .dropdown').removeClass('open');
                        $('.filter .dropdown, .filter .dropdown .current').removeClass('open');
                        $('.filter .dropdown__list, .filter .dropdown').css('height', '');
                        $('.filter .dropdown__list, .filter .dropdown').css('z-index', '0');
                        dropdown_container.css('height', '');
                        dropdown_container.css('overflow-y', 'hidden');
                        setTimeout(function () {
                            dropdown_container.css('z-index', '0');

                        }, 400);

                    } else {

                        $('.filter .dropdown, .filter .dropdown .current').removeClass('open');
                        $('.filter .dropdown__list, .filter .dropdown').css('height', '');
                        $('.filter .dropdown__list, .filter .dropdown').css('z-index', '0');

                        dropdown_container.siblings('.current').addClass('open');
                        dropdown_container.addClass('open');


                        dropdown_container.css('height', dropdown_height + 'px').css('z-index', '2');
                        setTimeout(function () {
                            dropdown_container.css('overflow-y', 'overlay');
                        }, 400);
                    }
                });

                $('.filter .dropdown__list li').on('click', function () {
                    var li_text = $(this).text();
                    var dropdown_container = $(this).parent().parent();
                    var current = $(this).parent().siblings('.current');
                    $(this).siblings().removeClass('active');
                    $(this).addClass('active');
                    current.text(li_text);
                    current.removeClass('open');
                    dropdown_container.removeClass('open').css('height', '');
                    dropdown_container.css('overflow-y', 'hidden');
                    setTimeout(function () {
                        dropdown_container.css('z-index', '0');
                    }, 400);
                    $(".dropdown").animate({
                        scrollTop: 0
                    }, 700)
                });

                /* Clear Filters */
                $('.sidebar .btn').on('click', function () {
                    $('.filter .dropdown__list li').removeClass('active');
                    $('.filter .dropdown__list li[data-filter="all"]').addClass('active');
                    $('.filter .dropdown .current').text('All');
                });

                /* Page Banner Slider */
                var currentIndex = 0,
                    items = $('.resources__slider .resource'),
                    toggle = $('.featured__resources .toggles .toggle'),
                    itemAmt = items.length;

                function cycleItems() {
                    var item = $('.resources__slider .resource').eq(currentIndex);
                    var toggle = $('.featured__resources .toggles .toggle').eq(currentIndex);

                    item.addClass('active');
                    toggle.addClass('active');
                    var counter = parseInt(currentIndex) + 1;
                    $('.toggles .toggle_count .current').text(counter);

                }

                // Set up autoslide timer
                var autoSlide;
                var timer = function () {
                    autoSlide = setInterval(function () {
                        items.removeClass('active');
                        toggle.removeClass('active');
                        currentIndex += 1;
                        if (currentIndex > itemAmt - 1) {
                            currentIndex = 0;
                        }
                        cycleItems();
                    }, 8000);
                };
                timer();

                /* Toggles */
                $('.featured__resources .toggles .toggle').on('click', function (event) {
                    event.preventDefault();
                    var slide = $(this).attr('data-slide');

                    // Clear autoslide and reset it
                    clearInterval(autoSlide);
                    timer();
                    /* Remove class active */
                    $('.featured__resources .toggles .toggle').removeClass('active');
                    $('.resources__slider .resource').removeClass('active');

                    /* Add class active to this toggle and the event that it is associated with */
                    $(this).addClass('active');
                    $('.resources__slider .resource[data-slide=' + slide + ']').addClass('active');

                    /* Change current index to this toggle/event */
                    currentIndex = slide;
                    cycleItems();
                });

                /* Filtering */
                $('.filter .dropdown__list li').on('click', function () {
                    filterResourceItems(this);
                    $('html,body').animate({
                        scrollTop: $(".resource__list").offset().top - 150
                    });
                });

                //Clear Filters
                $('.sidebar .btn__clear').on('click', function (e) {
                    e.preventDefault();
                    $('.filter .dropdown__list li').removeClass('active');
                    $('.filter .dropdown__list li[data-filter="author__all"], .filter .dropdown__list li[data-filter="cat__all"], .filter .dropdown__list li[data-filter="geo__all"], .filter .dropdown__list li[data-filter="lang__all"], .filter .dropdown__list li[data-filter="tags__all"], .filter .dropdown__list li[data-filter="year__all"]').addClass('active');
                    if ($('#collections').is(':checked')) {
                        $('#collections').click();
                    }
                    filterResourceItems();
                    $('html,body').animate({
                        scrollTop: $(".resource__list").offset().top - 150
                    });
                });

                /* Search */
                $('#search_resources').on('submit', function (e) {
                    e.preventDefault();
                    filterResourceItems();
                    $('html,body').animate({
                        scrollTop: $(".resource__list").offset().top
                    });
                });

                $('#search_resources .form__submit').on('click', function (e) {
                    e.preventDefault();
                    filterResourceItems();
                    $('html,body').animate({
                        scrollTop: $(".resource__list").offset().top - 150
                    });
                });

                /* Collections Toggle */
                $('.sidebar .filter__collections input[type=checkbox]').on('click', function (e) {


                    filterResourceItems();
                    $('html,body').animate({
                        scrollTop: $(".resource__list").offset().top - 150
                    });
                });

                // on click we are checking to see if collections is checked
                // if checked, we mark it as unchecked
                // if not checked, we mark as checked

                /* Load More Resources */
                var x = 6; //Set the initial amount and how much you want to move up by
                $('.resource__list .btn__load-more').on('click', function (e) {
                    e.preventDefault();
                    size_li = $(this).siblings('.resource').size();
                    x = (x + 6 <= size_li) ? x + 6 : size_li;
                    $(this).siblings('.resource:lt(' + x + ')').removeClass('hide');
                    $('html,body').animate({
                        scrollTop: $('.resource:nth-child(' + (x - 6) + ')').offset().top - 30
                    });
                    if (x == size_li) {
                        $(this).fadeOut(400);
                    }
                });
            }
        },


        /*
          Resource Library New
        */
        page_template_template_resources_new: {
            init: function () {

                var formData = $('#filterSort').serializeArray();

                /* Pagination/Filtering Logic */

                // 1. Get ajax url from framework.php
                var ajaxurl = data.ajaxurl;

                // 2. Create Function to grab all filters
                function getFilters() {

                    var dataToPass = [];

                    // a. Loop thru dropdown lists
                    $('.dropdown__list').each(function () {

                        // b. use (this) to specify current dropdown list + find .active
                        var getactive = $(this).find('.active');

                        // c. for as many active's, grab the filter
                        for (var i = 0; i < getactive.length; i++) {

                            var getFilter = getactive[i].dataset.filter;

                            if (getFilter !== "-1") {
                                var getCurrTax = getactive[i].dataset.taxonomy;

                                // d. add to array of objects (key, value)
                                dataToPass.push({
                                    taxonomy: getCurrTax,
                                    terms: getFilter,
                                    field: 'slug'
                                })
                            }
                        }
                    });

                    // e. pass array back to function / return statement
                    return dataToPass;
                };

                // 3. On each "filter" click, run that function
                $('.dropdown__list').on('click', function () {
                    cvf_load_all_posts(1);
                });

                function cvf_load_all_posts(page, search = "") {
                    // Start the transition
                    $(".cvf_pag_loading").fadeIn().css('background', '#e9f2f9');
                    var post_type;

                    console.log($('#collections').prop("checked"));

                    // This accounts for different post types. Show Resources or Collections?
                    // If collections checkbox is chcked
                    if ($('#collections').prop("checked")) {
                        // Is checked
                        console.log("checked");
                        post_type = "collections";
                    } else {
                        // Is not checked
                        console.log("not checked");
                        post_type = "resources";
                    }

                    var filters = getFilters();

                    // Data to receive from our server
                    // the value in 'action' is the key that will be identified by the 'wp_ajax_' hook
                    var data = {
                        page: page,
                        action: "demo-pagination-load-posts",
                        filters,
                        postType: post_type,
                        search
                    };

                    // Send the data
                    $.post(ajaxurl, data, function (response) {
                        // When posts load, fadeout the spinny svg
                        $('.animation-loading').fadeOut();

                        // If successful Append the data into our html container
                        $(".cvf_universal_container").html(response);

                        // End the transition
                        $(".cvf_pag_loading").css({'background': 'none', 'transition': 'all 1s ease-out'});

                        $('.cvf_universal_container .cvf-universal-pagination li.active').each(function () {
                            $(this).on('click', function () {

                                // Bring user back up to top of resources on click
                                $('html, body').animate({
                                    scrollTop: 900
                                }, 700);

                                // get filters
                                var page = $(this).attr('p');
                                // pass into below
                                cvf_load_all_posts(page);
                            })
                        });
                    });
                }

                // Load page 1 as the default
                cvf_load_all_posts(1);


                /* Sidebar */
                $('.sidebar .sidebar__title').on('click', function (e) {
                    e.preventDefault();
                    var filter_height = $('.filters .content').outerHeight();
                    $(this).toggleClass('open');
                    $('.filters').toggleClass('open');
                    if ($('.filters').hasClass('open')) {
                        $('.filters').css('max-height', filter_height + 'px');
                    } else {
                        $('.filters').css('max-height', '');
                    }
                });


                $('.filter .dropdown .current').on('click', function (e) {
                    e.preventDefault();

                    var dropdown_height = $(this).siblings('.dropdown__list').outerHeight() + $(this).outerHeight() + 2;
                    var dropdown_container = $(this).parent('.dropdown');


                    if (dropdown_container.hasClass('open')) {

                        dropdown_container.siblings('.current').removeClass('open');
                        dropdown_container.removeClass('open');

                        $('.filter .dropdown').removeClass('open');
                        $('.filter .dropdown, .filter .dropdown .current').removeClass('open');
                        $('.filter .dropdown__list, .filter .dropdown').css('height', '');
                        $('.filter .dropdown__list, .filter .dropdown').css('z-index', '0');
                        dropdown_container.css('height', '');
                        dropdown_container.css('overflow-y', 'hidden');
                        setTimeout(function () {
                            dropdown_container.css('z-index', '0');

                        }, 400);

                    } else {

                        $('.filter .dropdown, .filter .dropdown .current').removeClass('open');
                        $('.filter .dropdown__list, .filter .dropdown').css('height', '');
                        $('.filter .dropdown__list, .filter .dropdown').css('z-index', '0');

                        dropdown_container.siblings('.current').addClass('open');
                        dropdown_container.addClass('open');


                        dropdown_container.css('height', dropdown_height + 'px').css('z-index', '2');
                        setTimeout(function () {
                            dropdown_container.css('overflow-y', 'overlay');
                        }, 400);
                    }
                });

                $('.filter .dropdown__list li').on('click', function () {
                    var li_text = $(this).text();
                    var dropdown_container = $(this).parent().parent();
                    var current = $(this).parent().siblings('.current');
                    $(this).siblings().removeClass('active');
                    $(this).addClass('active');
                    current.text(li_text);
                    current.removeClass('open');
                    dropdown_container.removeClass('open').css('height', '');
                    dropdown_container.css('overflow-y', 'hidden');
                    setTimeout(function () {
                        dropdown_container.css('z-index', '0');
                    }, 400);
                    $(".dropdown").animate({
                        scrollTop: 0
                    }, 700)
                });

                /* Clear Filters */
                $('.sidebar .btn').on('click', function () {
                    $('.filter .dropdown__list li').removeClass('active');
                    $('.filter .dropdown__list li[data-filter="all"]').addClass('active');
                    $('.filter .dropdown .current').text('All');
                });

                /* Page Banner Slider */
                var currentIndex = 0,
                    items = $('.resources__slider .resource'),
                    toggle = $('.featured__resources .toggles .toggle'),
                    itemAmt = items.length;

                function cycleItems() {
                    var item = $('.resources__slider .resource').eq(currentIndex);
                    var toggle = $('.featured__resources .toggles .toggle').eq(currentIndex);

                    item.addClass('active');
                    toggle.addClass('active');
                    var counter = parseInt(currentIndex) + 1;
                    $('.toggles .toggle_count .current').text(counter);

                }

                // Set up autoslide timer
                var autoSlide;
                var timer = function () {
                    autoSlide = setInterval(function () {
                        items.removeClass('active');
                        toggle.removeClass('active');
                        currentIndex += 1;
                        if (currentIndex > itemAmt - 1) {
                            currentIndex = 0;
                        }
                        cycleItems();
                    }, 8000);
                };
                timer();

                /* Toggles */
                $('.featured__resources .toggles .toggle').on('click', function (event) {
                    event.preventDefault();
                    var slide = $(this).attr('data-slide');

                    // Clear autoslide and reset it
                    clearInterval(autoSlide);
                    timer();
                    /* Remove class active */
                    $('.featured__resources .toggles .toggle').removeClass('active');
                    $('.resources__slider .resource').removeClass('active');

                    /* Add class active to this toggle and the event that it is associated with */
                    $(this).addClass('active');
                    $('.resources__slider .resource[data-slide=' + slide + ']').addClass('active');

                    /* Change current index to this toggle/event */
                    currentIndex = slide;
                    cycleItems();
                });

                /* Filtering */
                $('.filter .dropdown__list li').on('click', function () {
                    filterResourceItems(this);
                    $('html,body').animate({
                        scrollTop: $(".resource__list").offset().top - 150
                    });
                });

                //Clear Filters
                $('.sidebar .btn__clear').on('click', function (e) {
                    e.preventDefault();
                    $('.filter .dropdown__list li').removeClass('active');
                    $('.filter .dropdown__list li[data-filter="author__all"], .filter .dropdown__list li[data-filter="cat__all"], .filter .dropdown__list li[data-filter="geo__all"], .filter .dropdown__list li[data-filter="lang__all"], .filter .dropdown__list li[data-filter="tags__all"], .filter .dropdown__list li[data-filter="year__all"]').addClass('active');
                    if ($('#collections').is(':checked')) {
                        $('#collections').click();
                    }
                    cvf_load_all_posts(1);
                    // filterResourceItems();
                    $('html,body').animate({
                        scrollTop: $(".resource__list").offset().top - 150
                    });
                });

                /* Search */
                $('#search_resources').on('submit', function (e) {
                    e.preventDefault();
                    // filterResourceItems();

                    var search_string = $("#search_resources_input").val();
                    console.log("User typed: " + search_string);
                    // call pag function, get the value of the 2nd param (search)
                    cvf_load_all_posts(1, search_string);

                    $('html,body').animate({
                        scrollTop: $(".resource__list").offset().top
                    });
                });

                /* Collections Toggle */
                $('.sidebar .filter__collections #collections').on('click', function (e) {
                    // console.log($(this).prop("checked"));
                    cvf_load_all_posts(1);
                    // console.log("check is clicked");
                    // filterResourceItems();
                    $('html,body').animate({
                        scrollTop: $(".resource__list").offset().top - 150
                    });
                });

                /* Load More Resources */
                var x = 6; //Set the initial amount and how much you want to move up by
                $('.resource__list .btn__load-more').on('click', function (e) {
                    e.preventDefault();
                    size_li = $(this).siblings('.resource').size();
                    x = (x + 6 <= size_li) ? x + 6 : size_li;
                    $(this).siblings('.resource:lt(' + x + ')').removeClass('hide');
                    $('html,body').animate({
                        scrollTop: $('.resource:nth-child(' + (x - 6) + ')').offset().top - 30
                    });
                    if (x == size_li) {
                        $(this).fadeOut(400);
                    }
                });
            }
        },

        /*
        Events - Landing
      */
        page_template_template_events: {
            init: function () {

                /* Sidebar */

                $('.filter .dropdown .current').on('click', function (e) {
                    e.preventDefault();
                    var dropdown_height = $(this).siblings('.dropdown__list').outerHeight() + $(this).outerHeight() + 2;
                    var dropdown_container = $(this).parent('.dropdown');
                    $(this).toggleClass('open');
                    dropdown_container.toggleClass('open');

                    if (dropdown_container.hasClass('open')) {
                        dropdown_container.css('height', dropdown_height + 'px').css('z-index', '1');
                    } else {
                        dropdown_container.css('height', '');
                        setTimeout(function () {
                            dropdown_container.css('z-index', '');
                        }, 400);
                    }
                });

                $('.filter .dropdown__list li').on('click', function () {
                    var li_text = $(this).text();
                    var dropdown_container = $(this).parent().parent();
                    var current = $(this).parent().siblings('.current');
                    $(this).siblings().removeClass('active');
                    $(this).addClass('active');
                    current.text(li_text);
                    current.removeClass('open');
                    dropdown_container.removeClass('open').css('height', '');
                    setTimeout(function () {
                        dropdown_container.css('z-index', '0');
                    }, 400);
                    $('.filter .dropdown__list li:first-child()').scrollTo(100);
                });


                $('.section__events .btn__search').on('submit click', function (e) {
                    e.preventDefault();
                    filterItems();
                    var cat_title = $('.section__events .filter .dropdown .current').text();
                    if ($('.section__events #start_date').val() != '') {

                        var start_date_filter = $('.section__events #start_date').val();
                        var end_date_filter = $('.section__events #end_date').val();
                        var dateFormat = $.datepicker.formatDate('yymmdd', new Date(start_date_filter));
                        var endDateFormat = $.datepicker.formatDate('yymmdd', new Date(end_date_filter));

                        $('.block:visible').each(function () {

                            if ($(this).attr('data-start-date') >= dateFormat && $(this).attr('data-start-date') <= endDateFormat) {

                            } else {
                                $(this).hide();
                            }

                        });
                        if ($('.block:visible').length == 0) {
                            $('.no-events').show();
                        } else {
                            $('.no-events').hide();
                        }

                    }
                    $('.section__events .cat_title').text(cat_title);
                    $('html,body').animate({
                        scrollTop: $('.section__events .events').offset().top
                    });
                });

            }
        },

        /*
        Events - Landing
      */
        page_template_template_events_past: {
            init: function () {

                /* Sidebar */

                $('.filter .dropdown .current').on('click', function (e) {
                    e.preventDefault();
                    var dropdown_height = $(this).siblings('.dropdown__list').outerHeight() + $(this).outerHeight() + 2;
                    var dropdown_container = $(this).parent('.dropdown');
                    $(this).toggleClass('open');
                    dropdown_container.toggleClass('open');

                    if (dropdown_container.hasClass('open')) {
                        dropdown_container.css('height', dropdown_height + 'px').css('z-index', '1');
                    } else {
                        dropdown_container.css('height', '');
                        setTimeout(function () {
                            dropdown_container.css('z-index', '');
                        }, 400);
                    }
                });

                $('.filter .dropdown__list li').on('click', function () {
                    var li_text = $(this).text();
                    var dropdown_container = $(this).parent().parent();
                    var current = $(this).parent().siblings('.current');
                    $(this).siblings().removeClass('active');
                    $(this).addClass('active');
                    current.text(li_text);
                    current.removeClass('open');
                    dropdown_container.removeClass('open').css('height', '');
                    setTimeout(function () {
                        dropdown_container.css('z-index', '0');
                    }, 400);
                    $('.filter .dropdown__list li:first-child()').scrollTo(100);
                });


                $('.section__events .btn__search').on('submit click', function (e) {
                    e.preventDefault();
                    filterItems();
                    var cat_title = $('.section__events .filter .dropdown .current').text();
                    if ($('.section__events #start_date').val() != '') {

                        var start_date_filter = $('.section__events #start_date').val();
                        var end_date_filter = $('.section__events #end_date').val();
                        var dateFormat = $.datepicker.formatDate('yymmdd', new Date(start_date_filter));
                        var endDateFormat = $.datepicker.formatDate('yymmdd', new Date(end_date_filter));

                        $('.block:visible').each(function () {

                            if ($(this).attr('data-start-date') >= dateFormat && $(this).attr('data-start-date') <= endDateFormat) {

                            } else {
                                $(this).hide();
                            }

                        });
                        if ($('.block:visible').length == 0) {
                            $('.no-events').show();
                        } else {
                            $('.no-events').hide();
                        }

                    }
                    $('.section__events .cat_title').text(cat_title);
                    $('html,body').animate({
                        scrollTop: $('.section__events .events').offset().top
                    });
                });

            }
        },

        /*
          Single Team Members
        */
        single_team_members: {
            init: function () {
                /* Load More Content */

                var btn_text = $('.section__general-content .btn__more span').text();
                $('.section__general-content .btn__more').on('click', function (e) {
                    e.preventDefault();
                    var data_hide = $(this).parent().attr('data-hide');

                    if ($(this).hasClass('open')) {

                        $(this).children('span').text('Less');
                        $('.section__general-content .content *').fadeIn(400);
                        $('html, body').animate({
                            scrollTop: $(this).parent().offset().top
                        }, 400);
                    } else {

                        $(this).children('span').text(btn_text);
                        $('.section__general-content p:nth-child(' + data_hide + ') ~ *:not(.btn)').fadeOut(400);
                        $('html, body').animate({
                            scrollTop: $(this).parent().parent().parent().offset().top
                        }, 400);
                    }

                });
            }
        },

        /*
          Postload
        */
        postload: {
            init: function () {

            }
        },

    };

// The routing fires all common scripts, followed by the page specific scripts.
// Add additional events for more control over timing e.g. a finalize event
    var UTIL = {
        fire: function (func, funcname, args) {
            var namespace = Roots;
            funcname = (funcname === undefined) ? 'init' : funcname;
            if (func !== '' && namespace[func] && typeof namespace[func][funcname] === 'function') {
                namespace[func][funcname](args);
            }
        },
        loadEvents: function () {
            UTIL.fire('preload');

            $.each(document.body.className.replace(/-/g, '_').split(/\s+/), function (i, classnm) {
                UTIL.fire(classnm);
            });

            UTIL.fire('postload');
        }
    };

    $(document).ready(UTIL.loadEvents);

})(jQuery);

/* Filter Event Items */
function filterItems(that) {

    var topic_filter = '',
        start_date_filter = '',
        end_date_filter = '';


    var container = $('.section__events .events .content__blocks');
    container.children('.block').css("display", '');
    var selector_string = '';

    $(that).toggleClass('active');

    if ($('.filter .dropdown__list .active').length == 0) {
        container.children('.block').css("display", '');
    } else {
        var topic_selector = '';
        $('.filter .dropdown__list .active').each(function () {

            var filter = $(this).attr('data-filter');

            if (filter != '') {
                selector_string += '[data-filter*=",' + filter + ',"]';
                if (topic_selector !== '') {
                    topic_selector += ',';
                }
                topic_selector += '[data-filter*=",' + filter + ',"]';
            }

        });

    }

    if (selector_string == '') {

        $('.no-events').hide();

    } else {

        container.children('.block').css("display", '');
        if (topic_selector) {
            container.children('.block').not(topic_selector).hide();
        }


        if (container.find('.block:visible').length == 0) {
            $('.no-events').show();
        } else {
            $('.no-events').hide();
        }
    }

}

/* Filter - Resources */

function filterResourceItems(that) {

    var cat_filter = '',
        author_filter = '',
        geo_filter = '',
        lang_filter = '',
        tags_filter = '',
        year_filter = '',
        search_selector = '',
        collections_selector = '';


    var container = $('.resource__list');
    container.children('.resource').css("display", '');
    var resource_selector_string = '';
    if ($("#search_resources_input").length) {
        var search_value = $("#search_resources_input").val().toLowerCase();
        if (search_value != '') {
            resource_selector_string += "[data-text*='" + search_value + "']";
            search_selector = "[data-text*='" + search_value + "']";
        }
    }

    if ($('#collections').is(':checked')) {
        resource_selector_string += "[data-post*='collections']";
        collections_selector = "[data-post*='collections']";
    } else {
        resource_selector_string = "";
        collections_selector = "";
    }

    if ($('.filter .dropdown__list li.active').length == 0) {
        container.children('.resource:not(".hide")').css("display", '');
    } else {
        var author_selector = '', cat_selector = '', geo_selector = '', lang_selector = '', tags_selector = '', year_selector = '';
        $('.filter .dropdown__list li.active').each(function () {

            var value = $(this).attr('data-filter').split('__')[1];
            var filter = $(this).attr('data-filter').split('__')[0];
            switch (filter) {
                case 'author':
                    author_filter = value;
                    break;
                case 'cat':
                    cat_filter = value;
                    break;
                case 'geo':
                    geo_filter = value;
                    break;
                case 'lang':
                    lang_filter = value;
                    break;
                case 'tags':
                    tags_filter = value;
                    break;
                case 'year':
                    year_filter = value;
                    break;
            }


        });
        //Category Filter
        if (cat_filter != '') {
            resource_selector_string += '[data-cat*=",' + cat_filter + ',"]';
            if (cat_selector !== '') {
                cat_selector += ',';
            }
            cat_selector += '[data-cat*=",' + cat_filter + ',"]';
        }
        //Author Filter
        if (author_filter != '') {
            resource_selector_string += '[data-author*=",' + author_filter + ',"]';
            if (author_selector !== '') {
                author_selector += ',';
            }
            author_selector += '[data-author*=",' + author_filter + ',"]';
        }
        //Geographical Focus filter
        if (geo_filter != '') {
            resource_selector_string += '[data-geo*=",' + geo_filter + ',"]';
            if (geo_selector !== '') {
                geo_selector += ',';
            }
            geo_selector += '[data-geo*=",' + geo_filter + ',"]';
        }
        // language filter
        if (lang_filter != '') {
            resource_selector_string += '[data-lang*=",' + lang_filter + ',"]';
            if (lang_selector !== '') {
                lang_selector += ',';
            }
            lang_selector += '[data-lang*=",' + lang_filter + ',"]';
        }
        // tags filter
        if (tags_filter != '') {
            resource_selector_string += '[data-tags*=",' + tags_filter + ',"]';
            if (tags_selector !== '') {
                tags_selector += ',';
            }
            tags_selector += '[data-tags*=",' + tags_filter + ',"]';
        }
        // year filter
        if (year_filter != '') {
            resource_selector_string += '[data-year*=",' + year_filter + ',"]';
            if (year_selector !== '') {
                year_selector += ',';
            }
            year_selector += '[data-year*=",' + year_filter + ',"]';
        }


    }
    if (resource_selector_string == '[data-cat*=",all,"][data-author*=",all,"][data-geo*=",all,"][data-lang*=",all,"][data-tags*=",all,"][data-year*=",all,"]' && !search_selector) {

        container.removeClass('show-hidden');
        $('.no-results').hide();
        $('.resource__list .btn__load-more').show();
    } else {
        container.addClass('show-hidden');
        container.children('.resource').css("display", '');
        $('.resource__list .btn__load-more').show();
        if (cat_selector) {
            container.children('.resource').not(cat_selector).hide();
        }
        if (author_selector) {
            container.children('.resource').not(author_selector).hide();
        }
        if (geo_selector) {
            container.children('.resource').not(geo_selector).hide();
        }
        if (lang_selector) {
            container.children('.resource').not(lang_selector).hide();
        }
        if (tags_selector) {
            container.children('.resource').not(tags_selector).hide();
        }
        if (year_selector) {
            container.children('.resource').not(year_selector).hide();
        }
        if (search_selector) {
            container.children('.resource').not(search_selector).hide();
        }
        if (collections_selector) {
            container.children('.resource').not(collections_selector).hide();
        }
        $('.resource__list .btn__load-more').hide();


        if (container.find('.resource:visible').length == 0) {
            $('.no-results').show();
        } else {
            $('.no-results').hide();
        }
    }

}
